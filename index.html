<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.10.16/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.10.16/js/dataTables.fixedColumns.min.js"></script>
<link href="libs/dt-ext-scroller-1.10.16/css/scroller.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-scroller-1.10.16/js/dataTables.scroller.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">機械学習勉強会(分類編)</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#section-1"><i class="fa fa-check"></i><b>1</b> 二値予測問題問題について</a></li>
<li class="chapter" data-level="2" data-path=""><a href="#section-2"><i class="fa fa-check"></i><b>2</b> データサイエンスのフレームワーク</a></li>
<li class="chapter" data-level="3" data-path=""><a href="#section-3"><i class="fa fa-check"></i><b>3</b> 問題定義</a></li>
<li class="chapter" data-level="4" data-path=""><a href="#section-4"><i class="fa fa-check"></i><b>4</b> データの収集</a></li>
<li class="chapter" data-level="5" data-path=""><a href="#-"><i class="fa fa-check"></i><b>5</b> 探索的データ解析 &amp; 前処理</a><ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#section-5.1"><i class="fa fa-check"></i><b>5.1</b> ライブラリの読み込み</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#section-5.2"><i class="fa fa-check"></i><b>5.2</b> データを概要をざっくり確認</a><ul>
<li class="chapter" data-level="5.2.1" data-path=""><a href="#titanic"><i class="fa fa-check"></i><b>5.2.1</b> titanicデータの内容について</a></li>
<li class="chapter" data-level="5.2.2" data-path=""><a href="#section-5.2.2"><i class="fa fa-check"></i><b>5.2.2</b> データのサマリー確認</a></li>
<li class="chapter" data-level="5.2.3" data-path=""><a href="#section-5.2.3"><i class="fa fa-check"></i><b>5.2.3</b> データ概要の確認結果</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path=""><a href="#-"><i class="fa fa-check"></i><b>5.3</b> データの詳細な解析 &amp; 前処理</a><ul>
<li class="chapter" data-level="5.3.1" data-path=""><a href="#4c"><i class="fa fa-check"></i><b>5.3.1</b> 前処理における「4C」</a></li>
<li class="chapter" data-level="5.3.2" data-path=""><a href="#section-5.3.2"><i class="fa fa-check"></i><b>5.3.2</b> 詳細解析に役立つパッケージ</a></li>
<li class="chapter" data-level="5.3.3" data-path=""><a href="#section-5.3.3"><i class="fa fa-check"></i><b>5.3.3</b> グラフによるデータの解析</a><ul>
<li class="chapter" data-level="5.3.3.1" data-path=""><a href="#section-5.3.3.1"><i class="fa fa-check"></i><b>5.3.3.1</b> 性別と生存率</a></li>
<li class="chapter" data-level="5.3.3.2" data-path=""><a href="#section-5.3.3.2"><i class="fa fa-check"></i><b>5.3.3.2</b> 年齢と生存率</a></li>
<li class="chapter" data-level="5.3.3.3" data-path=""><a href="#pclass"><i class="fa fa-check"></i><b>5.3.3.3</b> Pclassと生存率</a></li>
<li class="chapter" data-level="5.3.3.4" data-path=""><a href="#fare"><i class="fa fa-check"></i><b>5.3.3.4</b> Fareと生存率</a></li>
<li class="chapter" data-level="5.3.3.5" data-path=""><a href="#embarked"><i class="fa fa-check"></i><b>5.3.3.5</b> Embarkedと生存率</a></li>
<li class="chapter" data-level="5.3.3.6" data-path=""><a href="#sibspparch"><i class="fa fa-check"></i><b>5.3.3.6</b> SibSp/Parchと生存率</a></li>
<li class="chapter" data-level="5.3.3.7" data-path=""><a href="#name"><i class="fa fa-check"></i><b>5.3.3.7</b> Nameと生存率</a></li>
</ul></li>
<li class="chapter" data-level="5.3.4" data-path=""><a href="#converting"><i class="fa fa-check"></i><b>5.3.4</b> Converting(データのフォーマット変更)</a><ul>
<li class="chapter" data-level="5.3.4.1" data-path=""><a href="#section-5.3.4.1"><i class="fa fa-check"></i><b>5.3.4.1</b> 定量的データのビニングについて</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#section-6"><i class="fa fa-check"></i><b>6</b> データモデルの作成</a><ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#section-6.1"><i class="fa fa-check"></i><b>6.1</b> アルゴリズムの分類</a></li>
<li class="chapter" data-level="6.2" data-path=""><a href="#mlr"><i class="fa fa-check"></i><b>6.2</b> mlrによるモデル作成の流れ</a></li>
<li class="chapter" data-level="6.3" data-path=""><a href="#section-6.3"><i class="fa fa-check"></i><b>6.3</b> タスクの定義</a></li>
<li class="chapter" data-level="6.4" data-path=""><a href="#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 学習機の構築</a><ul>
<li class="chapter" data-level="6.4.1" data-path=""><a href="#section-6.4.1"><i class="fa fa-check"></i><b>6.4.1</b> アルゴリズムの選び方</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path=""><a href="#section-6.5"><i class="fa fa-check"></i><b>6.5</b> 学習機の性能評価</a></li>
<li class="chapter" data-level="6.6" data-path=""><a href="#section-6.6"><i class="fa fa-check"></i><b>6.6</b> モデルのパフォーマンス評価</a><ul>
<li class="chapter" data-level="6.6.1" data-path=""><a href="#section-6.6.1"><i class="fa fa-check"></i><b>6.6.1</b> ベースライン精度の決定</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path=""><a href="#section-6.7"><i class="fa fa-check"></i><b>6.7</b> ハイパーパラメータのチューニング</a><ul>
<li class="chapter" data-level="6.7.1" data-path=""><a href="#section-6.7.1"><i class="fa fa-check"></i><b>6.7.1</b> グリッドサーチ用のパラメータを設定する。</a></li>
<li class="chapter" data-level="6.7.2" data-path=""><a href="#section-6.7.2"><i class="fa fa-check"></i><b>6.7.2</b> グリッドサーチの実行</a></li>
<li class="chapter" data-level="6.7.3" data-path=""><a href="#section-6.7.3"><i class="fa fa-check"></i><b>6.7.3</b> チューニングされたハイパーパラメータの設定</a></li>
<li class="chapter" data-level="6.7.4" data-path=""><a href="#section-6.7.4"><i class="fa fa-check"></i><b>6.7.4</b> チューニング後の性能確認</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="section-1" class="section level1">
<h1><span class="header-section-number">1</span> 二値予測問題問題について</h1>
<ul>
<li>二値予測問題とは
<ul>
<li>テストに合格したか、しなかったか</li>
<li>生きてるか、死んでるか</li>
<li>顧客を維持できたか、できなかったか</li>
</ul></li>
<li>二値の問題なので、ランダムに推測しても50%の正解率は達成できるはず。</li>
<li>今回の例題では、機械学習を使用してどのようにオッズを克服するか説明する。
<ul>
<li>解析の参考は以下のkaggleのkernelを参考にしています(ただし社内からでは見られない)</li>
<li><a href="https://www.kaggle.com/ldfreeman3/a-data-science-framework-to-achieve-99-accuracy">A Data Science Framework: To Achieve 99% Accuracy</a></li>
</ul></li>
</ul>
</div>
<div id="section-2" class="section level1">
<h1><span class="header-section-number">2</span> データサイエンスのフレームワーク</h1>
<ol style="list-style-type: decimal">
<li><strong>問題定義</strong>:
<ul>
<li>データサイエンス・AI・ビッグデータ・機械学習を使って何をしたいかを明確にする。</li>
<li>機械学習を使わずに問題を解決できるのであれば、使わなくて良い。</li>
</ul></li>
<li><strong>データの収集</strong>:
<ul>
<li>問題を解決するためのデータを収集する。</li>
</ul></li>
<li><strong>探索的データ解析(EDA)</strong>:
<ul>
<li>データの特徴を捉え、仮説を立てる。</li>
<li>記述統計的に確認したり(平均、最大・最小値、度数 etc)、ひたすらグラフを書いて、データ内の潜在的な問題を探す。</li>
</ul></li>
<li><strong>データの前処理</strong>:
<ul>
<li>解析したいデータを、機械学習のアルゴリズムにインプットするために整形する。</li>
<li>データを把握しつつ、4C ( Correcting, Completeing, Creating, Converting )の工程を行う(後述)</li>
</ul></li>
<li><strong>データモデルの作成・検証・改良</strong>
<ul>
<li>与えられたデータセットと解決したい問題に応じて、データモデルを作成する。</li>
<li>作成したデータモデルの精度は十分か、過学習していないか等を考慮しながら改良していく。</li>
</ul></li>
<li><strong>分析結果を元とした施策の実行</strong>
<ul>
<li>解析した結果を元に、施策の実行を行う。</li>
</ul></li>
</ol>
</div>
<div id="section-3" class="section level1">
<h1><span class="header-section-number">3</span> 問題定義</h1>
<ul>
<li>今回の勉強会ではタイタニック号の乗客の生存結果を予測するためのアルゴリズムを開発する。</li>
<li>プロジェクトの概要は以下の通り(Google翻訳まま)</li>
</ul>
<blockquote>
<p>プロジェクトの概要： RMSタイタニック号の沈没は歴史上最も悪名高い難破船のひとつです。 1912年4月15日、乙女の航海中、タイタニック号は氷山と衝突した後沈没し、2224人の乗客と乗組員のうち1502人が死亡した。このセンセーショナルな悲劇は国際社会に衝撃を与え、船舶の安全規制を改善することにつながりました。</p>
<p>難破船がこのような命の喪失につながった理由の1つは、乗客と乗組員のための救命ボートが十分になかったことです。沈没を乗り切ることには何らかの幸運の要素が関係していましたが、女性、子供、そして上流階級のように、他の人々よりも生き残る可能性が高いグループがありました。</p>
<p>この課題では、どのような種類の人々が生き残る可能性が高いかの分析を完了するようお願いします。特に、どの乗客が悲劇を乗り越えたかを予測するために、機械学習のツールを適用するようお願いします。</p>
</blockquote>
</div>
<div id="section-4" class="section level1">
<h1><span class="header-section-number">4</span> データの収集</h1>
<p>今回のデータはRの<code>titanic</code> ライブラリのデータを使用。</p>
</div>
<div id="-" class="section level1">
<h1><span class="header-section-number">5</span> 探索的データ解析 &amp; 前処理</h1>
<p>今回使用するデータについて、データの内容を解析しつつ機械学習用の前処理を行う。</p>
<div id="section-5.1" class="section level2">
<h2><span class="header-section-number">5.1</span> ライブラリの読み込み</h2>
<p>解析に必要なライブラリを読み込んでいく</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## *ライブラリの読み込み----

<span class="co"># tidyverse:</span>
<span class="co"># dplyr, tidyr, purrr などの</span>
<span class="co"># 解析に必要なパッケージが全てまとまったライブラリ</span>
<span class="kw">library</span>(tidyverse)

<span class="co"># magrittr:</span>
<span class="co"># パイプ演算子(%&gt;%)の亜種(%&lt;&gt;%, %T&gt;%, %$%)を使用するためのライブラリ</span>
<span class="kw">library</span>(magrittr)

<span class="co"># ggplot2:</span>
<span class="co"># グラフ作成用ライブラリ</span>
<span class="kw">library</span>(ggplot2)

<span class="co"># infotheo:</span>
<span class="co"># 連続値を離散値に変換するために使用(discretize)</span>
<span class="kw">library</span>(infotheo)

<span class="co"># Hmisc:</span>
<span class="co"># リストを見やすく表示するlist.tree()のために使用</span>
<span class="kw">library</span>(Hmisc)

<span class="co"># DataExplorer:</span>
<span class="co"># データの概要をレポート形式でまとめてくれるライブラリ</span>
<span class="kw">library</span>(DataExplorer)

<span class="co"># rpivotTable:</span>
<span class="co"># ピボットテーブルを作成するライブラリ</span>
<span class="kw">library</span>(rpivotTable)

<span class="co"># esquisse:</span>
<span class="co"># ggplotのグラフをGUIで作成するためのライブラリ</span>
<span class="kw">library</span>(esquisse)

<span class="co"># mlr:</span>
<span class="co"># 機械学習関連のパッケージが全てまとまったライブラリ</span>
<span class="kw">library</span>(mlr)

<span class="co"># DT:</span>
<span class="co"># Rmd形式でデータを出力する際に見やすい形式にするためのライブラリ</span>
<span class="co"># (コード単体を回す際は必要なし)</span>
<span class="kw">library</span>(DT)

<span class="co"># titanic:</span>
<span class="co"># 勉強会で使用するデータを読み込むために使用</span>
<span class="kw">library</span>(titanic)</code></pre></div>
</div>
<div id="section-5.2" class="section level2">
<h2><span class="header-section-number">5.2</span> データを概要をざっくり確認</h2>
<p><code>head()</code>, <code>summary()</code>, <code>View()</code>などを使ってデータの概略をすばやく確認する。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## *探索的データ分析(EDA) ----

<span class="co"># データの確認(datatableはRmd用, テーブルは横スクロール可能)----</span>
titanic<span class="op">::</span>titanic_train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">datatable</span>(
    <span class="dt">rownames =</span> <span class="ot">FALSE</span>,
    <span class="dt">class =</span> <span class="st">&#39;nowrap&#39;</span>,
    <span class="dt">extensions =</span> <span class="kw">c</span>(<span class="st">&#39;FixedColumns&#39;</span>,<span class="st">&#39;Scroller&#39;</span>),
    <span class="dt">options =</span> <span class="kw">list</span>(
      <span class="co"># FixedColumns</span>
      <span class="dt">dom          =</span> <span class="st">&#39;Bfrtip&#39;</span>,
      <span class="dt">scrollX      =</span> <span class="ot">TRUE</span>,
      <span class="co"># Scroller</span>
      <span class="dt">deferRender =</span> <span class="ot">TRUE</span>,
      <span class="dt">scrollY =</span> <span class="dv">200</span>,
      <span class="dt">scroller =</span> <span class="ot">TRUE</span>
    )
  )</code></pre></div>
<div id="htmlwidget-286e63eb1686adc54c99" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-286e63eb1686adc54c99">{"x":{"filter":"none","extensions":["FixedColumns","Scroller"],"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,0,1,0,0,1,1,0,0,0,1,0,0,1,0,0,0,1,1,0,0,1,0,0],[3,1,3,1,3,3,1,3,3,2,3,1,3,3,3,2,3,2,3,3,2,2,3,1,3,3,3,1,3,3,1,1,3,2,1,1,3,3,3,3,3,2,3,2,3,3,3,3,3,3],["Braund, Mr. Owen Harris","Cumings, Mrs. John Bradley (Florence Briggs Thayer)","Heikkinen, Miss. Laina","Futrelle, Mrs. Jacques Heath (Lily May Peel)","Allen, Mr. William Henry","Moran, Mr. James","McCarthy, Mr. Timothy J","Palsson, Master. Gosta Leonard","Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)","Nasser, Mrs. Nicholas (Adele Achem)","Sandstrom, Miss. Marguerite Rut","Bonnell, Miss. Elizabeth","Saundercock, Mr. William Henry","Andersson, Mr. Anders Johan","Vestrom, Miss. Hulda Amanda Adolfina","Hewlett, Mrs. (Mary D Kingcome) ","Rice, Master. Eugene","Williams, Mr. Charles Eugene","Vander Planke, Mrs. Julius (Emelia Maria Vandemoortele)","Masselmani, Mrs. Fatima","Fynney, Mr. Joseph J","Beesley, Mr. Lawrence","McGowan, Miss. Anna \"Annie\"","Sloper, Mr. William Thompson","Palsson, Miss. Torborg Danira","Asplund, Mrs. Carl Oscar (Selma Augusta Emilia Johansson)","Emir, Mr. Farred Chehab","Fortune, Mr. Charles Alexander","O'Dwyer, Miss. Ellen \"Nellie\"","Todoroff, Mr. Lalio","Uruchurtu, Don. Manuel E","Spencer, Mrs. William Augustus (Marie Eugenie)","Glynn, Miss. Mary Agatha","Wheadon, Mr. Edward H","Meyer, Mr. Edgar Joseph","Holverson, Mr. Alexander Oskar","Mamee, Mr. Hanna","Cann, Mr. Ernest Charles","Vander Planke, Miss. Augusta Maria","Nicola-Yarred, Miss. Jamila","Ahlin, Mrs. Johan (Johanna Persdotter Larsson)","Turpin, Mrs. William John Robert (Dorothy Ann Wonnacott)","Kraeff, Mr. Theodor","Laroche, Miss. Simonne Marie Anne Andree","Devaney, Miss. Margaret Delia","Rogers, Mr. William John","Lennon, Mr. Denis","O'Driscoll, Miss. Bridget","Samaan, Mr. Youssef","Arnold-Franchi, Mrs. Josef (Josefine Franchi)"],["male","female","female","female","male","male","male","male","female","female","female","female","male","male","female","female","male","male","female","female","male","male","female","male","female","female","male","male","female","male","male","female","female","male","male","male","male","male","female","female","female","female","male","female","female","male","male","female","male","female"],[22,38,26,35,35,null,54,2,27,14,4,58,20,39,14,55,2,null,31,null,35,34,15,28,8,38,null,19,null,null,40,null,null,66,28,42,null,21,18,14,40,27,null,3,19,null,null,null,null,18],[1,1,0,1,0,0,0,3,0,1,1,0,0,1,0,0,4,0,1,0,0,0,0,0,3,1,0,3,0,0,0,1,0,0,1,1,0,0,2,1,1,1,0,1,0,0,1,0,2,1],[0,0,0,0,0,0,0,1,2,0,1,0,0,5,0,0,1,0,0,0,0,0,0,0,1,5,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],["A/5 21171","PC 17599","STON/O2. 3101282","113803","373450","330877","17463","349909","347742","237736","PP 9549","113783","A/5. 2151","347082","350406","248706","382652","244373","345763","2649","239865","248698","330923","113788","349909","347077","2631","19950","330959","349216","PC 17601","PC 17569","335677","C.A. 24579","PC 17604","113789","2677","A./5. 2152","345764","2651","7546","11668","349253","SC/Paris 2123","330958","S.C./A.4. 23567","370371","14311","2662","349237"],[7.25,71.2833,7.925,53.1,8.05,8.4583,51.8625,21.075,11.1333,30.0708,16.7,26.55,8.05,31.275,7.8542,16,29.125,13,18,7.225,26,13,8.0292,35.5,21.075,31.3875,7.225,263,7.8792,7.8958,27.7208,146.5208,7.75,10.5,82.1708,52,7.2292,8.05,18,11.2417,9.475,21,7.8958,41.5792,7.8792,8.05,15.5,7.75,21.6792,17.8],["","C85","","C123","","","E46","","","","G6","C103","","","","","","","","","","D56","","A6","","","","C23 C25 C27","","","","B78","","","","","","","","","","","","","","","","","",""],["S","C","S","S","S","Q","S","S","S","C","S","S","S","S","S","S","Q","S","S","C","S","S","Q","S","S","S","C","S","Q","S","C","C","Q","S","C","S","C","S","S","C","S","S","C","C","Q","S","Q","Q","C","S"]],"container":"<table class=\"nowrap\">\n  <thead>\n    <tr>\n      <th>PassengerId<\/th>\n      <th>Survived<\/th>\n      <th>Pclass<\/th>\n      <th>Name<\/th>\n      <th>Sex<\/th>\n      <th>Age<\/th>\n      <th>SibSp<\/th>\n      <th>Parch<\/th>\n      <th>Ticket<\/th>\n      <th>Fare<\/th>\n      <th>Cabin<\/th>\n      <th>Embarked<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","scrollX":true,"deferRender":true,"scrollY":200,"scroller":true,"columnDefs":[{"className":"dt-right","targets":[0,1,2,5,6,7,9]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View()でデータの確認</span>
<span class="co"># titanic_train %&gt;% View</span></code></pre></div>
<div id="titanic" class="section level3">
<h3><span class="header-section-number">5.2.1</span> titanicデータの内容について</h3>
<p>各列の意味は以下の通り</p>
<table>
<thead>
<tr class="header">
<th align="left">列名</th>
<th align="left">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PassengerId</td>
<td align="left">乗客識別ユニークID</td>
</tr>
<tr class="even">
<td align="left">Survived</td>
<td align="left">生存フラグ（0=死亡、1=生存）</td>
</tr>
<tr class="odd">
<td align="left">Pclass</td>
<td align="left">チケットクラス(1=お金持ち、2=一般階級、3=労働階級)</td>
</tr>
<tr class="even">
<td align="left">Name</td>
<td align="left">乗客の名前</td>
</tr>
<tr class="odd">
<td align="left">Sex</td>
<td align="left">性別（male=男性、female＝女性）</td>
</tr>
<tr class="even">
<td align="left">Age</td>
<td align="left">年齢</td>
</tr>
<tr class="odd">
<td align="left">SibSp</td>
<td align="left">タイタニックに同乗している兄弟/配偶者の数</td>
</tr>
<tr class="even">
<td align="left">parch</td>
<td align="left">タイタニックに同乗している親/子供の数</td>
</tr>
<tr class="odd">
<td align="left">ticket</td>
<td align="left">チケット番号</td>
</tr>
<tr class="even">
<td align="left">fare</td>
<td align="left">料金</td>
</tr>
<tr class="odd">
<td align="left">cabin</td>
<td align="left">客室番号</td>
</tr>
<tr class="even">
<td align="left">Embarked</td>
<td align="left">出港地（タイタニックへ乗った港、C=Cherbourg、Q=Queenstown、S=Southampton）</td>
</tr>
</tbody>
</table>
</div>
<div id="section-5.2.2" class="section level3">
<h3><span class="header-section-number">5.2.2</span> データのサマリー確認</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># クラスの確認----</span>
titanic_train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(class) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">list.tree</span>()</code></pre></div>
<pre><code>#  . = list 12 (2544 bytes)
# .  PassengerId = character 1= integer 
# .  Survived = character 1= integer 
# .  Pclass = character 1= integer 
# .  Name = character 1= character 
# .  Sex = character 1= character 
# .  Age = character 1= numeric 
# .  SibSp = character 1= integer 
# .  Parch = character 1= integer 
# .  Ticket = character 1= character 
# .  Fare = character 1= numeric 
# .  Cabin = character 1= character 
# .  Embarked = character 1= character</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># データのサマリーの確認----</span>
<span class="co"># ・titanic_trainではcharacter型のNAが&quot;&quot;となっているため、&quot;&quot;をNAに変換する</span>
<span class="co">#   (NAの数をカウントするため)</span>
<span class="co"># ・character型の列とその他一部の列について、factor型への変換を行う</span>
<span class="co">#   (要素数をカウントするため。)</span>

titanic<span class="op">::</span>titanic_train <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_if</span>(
    <span class="dt">.predicate =</span> is.character,
    <span class="dt">.funs =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(.<span class="op">==</span><span class="st">&quot;&quot;</span>,<span class="ot">NA</span>,.) <span class="op">%&gt;%</span><span class="st"> </span>factor
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(
    <span class="dt">.vars =</span> <span class="kw">c</span>(<span class="st">&#39;Survived&#39;</span>,<span class="st">&#39;Pclass&#39;</span>,<span class="st">&#39;Sex&#39;</span>),
    <span class="dt">.funs =</span> factor
  ) <span class="op">%&gt;%</span>
<span class="st">  </span>summary</code></pre></div>
<pre><code>#   PassengerId    Survived Pclass 
#  Min.   :  1.0   0:549    1:216  
#  1st Qu.:223.5   1:342    2:184  
#  Median :446.0            3:491  
#  Mean   :446.0                   
#  3rd Qu.:668.5                   
#  Max.   :891.0                   
#                                  
#                                     Name         Sex           Age       
#  Abbing, Mr. Anthony                  :  1   female:314   Min.   : 0.42  
#  Abbott, Mr. Rossmore Edward          :  1   male  :577   1st Qu.:20.12  
#  Abbott, Mrs. Stanton (Rosa Hunt)     :  1                Median :28.00  
#  Abelson, Mr. Samuel                  :  1                Mean   :29.70  
#  Abelson, Mrs. Samuel (Hannah Wizosky):  1                3rd Qu.:38.00  
#  Adahl, Mr. Mauritz Nils Martin       :  1                Max.   :80.00  
#  (Other)                              :885                NA&#39;s   :177    
#      SibSp           Parch             Ticket         Fare       
#  Min.   :0.000   Min.   :0.0000   1601    :  7   Min.   :  0.00  
#  1st Qu.:0.000   1st Qu.:0.0000   347082  :  7   1st Qu.:  7.91  
#  Median :0.000   Median :0.0000   CA. 2343:  7   Median : 14.45  
#  Mean   :0.523   Mean   :0.3816   3101295 :  6   Mean   : 32.20  
#  3rd Qu.:1.000   3rd Qu.:0.0000   347088  :  6   3rd Qu.: 31.00  
#  Max.   :8.000   Max.   :6.0000   CA 2144 :  6   Max.   :512.33  
#                                   (Other) :852                   
#          Cabin     Embarked  
#  B96 B98    :  4   C   :168  
#  C23 C25 C27:  4   Q   : 77  
#  G6         :  4   S   :644  
#  C22 C26    :  3   NA&#39;s:  2  
#  D          :  3             
#  (Other)    :186             
#  NA&#39;s       :687</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 死亡率を計算----</span>
<span class="co"># (常に&quot;死亡した&quot;と予測しても正解率は61.6%程度となる)</span>
Dead_rate =<span class="st"> </span><span class="dv">549</span><span class="op">/</span>(<span class="dv">342</span><span class="op">+</span><span class="dv">549</span>)
Dead_rate <span class="op">%&gt;%</span><span class="st"> </span>print</code></pre></div>
<pre><code># [1] 0.6161616</code></pre>
</div>
<div id="section-5.2.3" class="section level3">
<h3><span class="header-section-number">5.2.3</span> データ概要の確認結果</h3>
<ul>
<li><code>Survived</code>は今回のプロジェクトで推定したい値。
<ul>
<li><strong>推定の際は、的確な説明変数の組み合わせを選択することが重要。</strong></li>
<li><strong>単に説明変数を増やせば精度が上がる、というわけではない</strong></li>
</ul></li>
<li><code>PassengerID</code>は乗客を一意に識別するためのIDなので、説明変数には用いない。</li>
<li><code>Ticket</code>についても、乗客に与えられたランダムな識別子として考え、今回は除外。</li>
<li><code>Name</code>には様々な情報が入っているため、後々特徴量エンジニアリングで使用することができる。
<ul>
<li>Master. やDr. のtitleから社会的地位を抽出可能</li>
<li>Mr. や Mrs. のtitleから性別が抽出可能(今回は既にSexの情報があるため使わない)</li>
</ul></li>
<li><code>SibSp</code>や<code>Parch</code>は後々、特徴量エンジニアリングで使用。 　- 「乗客に含まれる家族の人数」や「乗客が家族なしで乗っていたかどうか」を抽出する。</li>
<li><code>Cabin</code>も<code>Name</code>と同じように、様々な情報が含まれている
<ul>
<li>事故が発生した時の船内での位置の推定ができそう</li>
<li>客室のレベルによる社会的地位の推定ができそう</li>
<li>ただし、<code>NA</code>が多いため今回の分析からは除外</li>
</ul></li>
</ul>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">5.3</span> データの詳細な解析 &amp; 前処理</h2>
<ul>
<li>データの概要を掴んだ後は、以下のような方法でグラフの詳細を分析していく。
<ul>
<li>ピボットテーブルを作成してみる。</li>
<li>ひたすらグラフを書いてみる。</li>
<li>思い当たるデータの変形を試してみる。</li>
</ul></li>
<li>データの解析を行いながら、並行して機械学習用の前処理工程も行っていく。</li>
</ul>
<div id="4c" class="section level3">
<h3><span class="header-section-number">5.3.1</span> 前処理における「4C」</h3>
<p>機械学習にかけるための前処理として、以下の「4C」の工程を行う必要がある。</p>
<ul>
<li><strong>Correcting</strong>
<ul>
<li>異常値は外れ値の修正処理。</li>
<li>もしデータを確認した際、明らかな異常があれば修正or除外するか決定する。</li>
<li>今回のプロジェクトの<code>sumarry()</code>からは、一見異常(age=800など)は見当たらない。</li>
</ul></li>
<li><strong>Completeing</strong>
<ul>
<li>データに含まれる<code>NA</code>に対する補完処理。
<ul>
<li>機械学習のアルゴリズムによっては<code>NA</code>が処理できないため、補完が必要</li>
</ul></li>
<li><code>NA</code>に対する処理としては、以下の方法が基本的
<ul>
<li>レコードの削除(大半のデータが<code>NA</code>でない限りは非推奨)</li>
<li>平均値・中央値で置き換え(定量的データ)</li>
<li>最頻値で置き換え(定性的データ)</li>
<li>平均値 ± 標準偏差に収まる程度の乱数で置き換え</li>
<li>欠損値自体を何かしらの方法で推測
<ul>
<li>手間と計算コストがかかるため、まずは基本的な補完を行うことが先決。</li>
</ul></li>
</ul></li>
<li>今回のプロジェクトでは、<code>NA</code>に対して以下の処理を行う。
<ul>
<li><code>Cabin</code>:<code>NA</code>が多いので削除</li>
<li><code>age</code>:中央値を代入</li>
<li><code>Embarked</code>：最頻値を代入</li>
</ul></li>
</ul></li>
<li><strong>Creating</strong>
<ul>
<li>既存の変数を使用して新しい特徴量を作成する(特徴量エンジニアリングとも)
<ul>
<li>データサイエンスの芸術的な部分とも言われ、解析者の腕が試される。</li>
</ul></li>
<li>今回のプロジェクトでは、Nameに含まれるtitleについて特徴量を作成し、Survivedに影響するか確認する。</li>
</ul></li>
<li><strong>Converting</strong>
<ul>
<li>データのフォーマットの変更処理。</li>
<li><code>mlr</code>では分類問題の目的変数はfactor型に設定する必要があるため、変換する。</li>
<li>定量的データはそのままだと機械学習のアルゴリズムにかけられないため、ダミー変数へ変換する。</li>
</ul></li>
</ul>
<p>引き続きデータの探索的解析を行いつつ、同時に前処理も行っていく。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 探索用データの作成----</span>
<span class="co"># 1. character型の空白行をNAへ変換</span>
<span class="co"># 2. 相関を確認したいcharacter型のみfactor型へ変換(create_report関数への入力用)</span>
<span class="co"># 3. dummy変数であるSurvived/Pclassもfactor型へ変換</span>
<span class="co"># 4. PassengerId は解析に使用しないため削除</span>

data_eda &lt;-
<span class="st">  </span>titanic<span class="op">::</span>titanic_train <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_if</span>(
    <span class="dt">.predicate =</span> is.character,
    <span class="dt">.funs =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(.<span class="op">==</span><span class="st">&quot;&quot;</span>,<span class="ot">NA</span>,.)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(
    <span class="dt">.vars =</span> <span class="kw">c</span>(<span class="st">&#39;Survived&#39;</span>,<span class="st">&#39;Pclass&#39;</span>,<span class="st">&#39;Sex&#39;</span>,<span class="st">&#39;Embarked&#39;</span>),
    <span class="dt">.funs =</span> factor
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>PassengerId)

<span class="co"># 各列のNAの割合を確認----</span>
data_eda <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_missing</span>()</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Completeing:欠損値補完(後述) ----</span>
<span class="co"># 欠損値の多いCabinはデータから削除し</span>
<span class="co"># Age,EmbarkはMedian,Modeで補完</span>
data_eda <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Cabin) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>mlr<span class="op">::</span><span class="kw">impute</span>(
    <span class="dt">cols=</span><span class="kw">list</span>(
      <span class="dt">Age =</span> <span class="kw">imputeMedian</span>(),
      <span class="dt">Embarked =</span> <span class="kw">imputeMode</span>()
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>data</code></pre></div>
</div>
<div id="section-5.3.2" class="section level3">
<h3><span class="header-section-number">5.3.2</span> 詳細解析に役立つパッケージ</h3>
<p>以下の3つのパッケージはすばやくデータを確認する際に役立つ。</p>
<ul>
<li><code>DataExplorer</code> : データの概要をグラフ化したレポートを自動で作成する。</li>
<li><code>rpivotTable</code> : ピボットテーブルが作成できるパッケージ。</li>
<li><code>esquisser</code> : GUIで<code>ggplot2</code>の作成ができるパッケージ。</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 詳細解析に便利なパッケージ3種類----</span>

<span class="co"># レポートの作成</span>
<span class="co">#data_eda %&gt;% DataExplorer::create_report()</span>

<span class="co"># ピボットテーブルの確認</span>
<span class="co">#data_eda %&gt;% rpivotTable::rpivotTable()</span>

<span class="co"># 単純なグラフの確認</span>
<span class="co">#data_eda %&gt;% esquisse::esquisser()</span></code></pre></div>
</div>
<div id="section-5.3.3" class="section level3 tabset">
<h3><span class="header-section-number">5.3.3</span> グラフによるデータの解析</h3>
<div id="section-5.3.3.1" class="section level4">
<h4><span class="header-section-number">5.3.3.1</span> 性別と生存率</h4>
<p>男性より女性のほうが生存率が高い <img src="titanic_r2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="section-5.3.3.2" class="section level4">
<h4><span class="header-section-number">5.3.3.2</span> 年齢と生存率</h4>
<p>生存者/死亡者の密度曲線</p>
<ul>
<li>年齢が18歳以下であれば死亡者より生存者のほうが多い</li>
<li>年齢が65歳以上になると死亡率が大きくなる。</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>年齢をbiningして生存率を確認する。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 年齢をbiningして生存率を確認する</span>
data_eda <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">AgeBin =</span> Age <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discretize</span>(<span class="dt">disc=</span><span class="st">&quot;equalwidth&quot;</span>,<span class="dt">nbins=</span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>X <span class="op">%&gt;%</span><span class="st"> </span>factor
  )</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="pclass" class="section level4">
<h4><span class="header-section-number">5.3.3.3</span> Pclassと生存率</h4>
<ul>
<li>部屋の等級が上がっていくにつれて生存率が高くなる</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="fare" class="section level4">
<h4><span class="header-section-number">5.3.3.4</span> Fareと生存率</h4>
<p>生存者/死亡者の密度曲線</p>
<ul>
<li>乗船料が高くなるほど生存率も高くなる。</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><code>Fare</code>をbiningして生存率を確認する。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fareをbiningして生存率を確認する</span>
data_eda <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">FareBin =</span> Fare <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">discretize</span>(<span class="dt">disc=</span><span class="st">&quot;equalfreq&quot;</span>,<span class="dt">nbins=</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>X <span class="op">%&gt;%</span><span class="st"> </span>factor
  )</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="embarked" class="section level4">
<h4><span class="header-section-number">5.3.3.5</span> Embarkedと生存率</h4>
<ul>
<li>出港地がC, Q, Sの順に生存率が高い。</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Pclass別にEmbarked別の生存率を確認</p>
<ul>
<li><code>Pclass</code>が同じでも、出港地がCであれば生存しやすく、Sであれば死亡しやすい</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-15-1.png" width="672" /><img src="titanic_r2_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
</div>
<div id="sibspparch" class="section level4">
<h4><span class="header-section-number">5.3.3.6</span> SibSp/Parchと生存率</h4>
<ul>
<li><code>SibSp</code>は兄弟/配偶者の数。<code>Parch</code>は親/子供の数。</li>
<li><code>SibSp</code>は2の乗客が最も生存率が高く、その後SibSpが高くなるに連れ生存率は下がる。</li>
<li><code>Parch</code>は4以上になると生存率が極度に低くなる。</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-16-1.png" width="672" /><img src="titanic_r2_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<p>新たに<code>FamilySize</code>, <code>IsAlone</code>といった特徴量を作成し、生存率を確認してみる。</p>
<ul>
<li><code>FamilySize</code> SibSp+Parch+1で算出。</li>
<li><code>IsAlone</code> SibSpとParchの両方が0であれば<code>Alone</code>,それ以外であれば<code>NotAlone</code>とする。</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># FamilySizeと生存確率の確認</span>
data_eda <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">FamilySize =</span> SibSp<span class="op">+</span>Parch<span class="op">+</span><span class="dv">1</span>)</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># IsAloneフラグ(乗客に家族がいるか)で生存率が変わるか確認</span>
<span class="co"># (独り身は死亡しやすい)</span>
data_eda <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">IsAlone =</span> <span class="kw">ifelse</span>(SibSp<span class="op">+</span>Parch<span class="op">==</span><span class="dv">0</span>,<span class="st">&quot;Alone&quot;</span>,<span class="st">&quot;NotAlone&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>factor)</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>作成した<code>FamilySize</code>, <code>IsAlone</code>が生存率を説明する有効な特徴量かを確認。</p>
<ul>
<li><code>Survived</code>と<code>FamilySize</code>はあまり相関が見えない</li>
<li><code>Survived</code>と<code>IsAlone</code>は、<code>SibSp</code>や<code>Parch</code>よりも強い相関があることがわかる。
<ul>
<li>このため、<code>IsAlone</code>は新たな特徴量として後ほど採用する。</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># FamilySize, IsAloneとSurvivedの相関を確認----</span>
<span class="co"># IsAloneはSurvivedと相関が強いため、新たな特徴量として後ほど使用</span>
data_eda <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    Survived,
    SibSp,
    Parch,
    FamilySize,
    IsAlone
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_correlation</span>()</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="name" class="section level4">
<h4><span class="header-section-number">5.3.3.7</span> Nameと生存率</h4>
<p><code>Name</code>変数に含まれる<code>Title</code>(Mr, Miss, Dr など)を抽出する</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Nameに含まれるTitleと生存率について----</span>

<span class="co"># NameからTitleを抽出</span>
data_eda <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Title =</span> Name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_extract</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">w+</span><span class="ch">\\</span><span class="st">.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)
  )

<span class="co"># Titleの中身を確認</span>
data_title &lt;-
<span class="st">  </span>data_eda <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(Title) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(count))

data_title <span class="op">%&gt;%</span><span class="st"> </span>print</code></pre></div>
<pre><code># # A tibble: 17 x 2
#    Title    count
#    &lt;chr&gt;    &lt;int&gt;
#  1 Mr         517
#  2 Miss       182
#  3 Mrs        125
#  4 Master      40
#  5 Dr           7
#  6 Rev          6
#  7 Col          2
#  8 Major        2
#  9 Mlle         2
# 10 Capt         1
# 11 Countess     1
# 12 Don          1
# 13 Jonkheer     1
# 14 Lady         1
# 15 Mme          1
# 16 Ms           1
# 17 Sir          1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Titleの数が基準値(stat_min)よりも小さければ「Misc」としてまとめる</span>
<span class="co"># (Titleに対する過学習を防ぐため)</span>
stat_min &lt;-<span class="dv">5</span>
title_names &lt;-<span class="st"> </span>data_title<span class="op">$</span>Title[data_title<span class="op">$</span>count <span class="op">&lt;</span><span class="st"> </span>stat_min]
data_eda <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Title=</span><span class="kw">ifelse</span>(<span class="kw">is.element</span>(Title,title_names),<span class="st">&quot;Misc&quot;</span>,Title) <span class="op">%&gt;%</span><span class="st"> </span>factor)</code></pre></div>
<p><code>Title</code>毎の生存率を確認</p>
<ul>
<li>男女合算で<code>Title</code>別生存率を見ると、男女差の効果に埋もれてしまい<code>Title</code>の効果が分かりづらい</li>
<li>男女別に<code>Title</code>別生存率を見ると、Dr, Master, Misc では生存率が上がり、Rev(牧師)は生存者がいないことが分かる。</li>
<li><code>Survived</code>を説明する変数として後々使用することとする。</li>
</ul>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="titanic_r2_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
</div>
</div>
<div id="converting" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Converting(データのフォーマット変更)</h3>
<p>「4C」の最後の一つである、機械学習用のフォーマット変更を行う。</p>
<ul>
<li>不必要な説明変数(Name,Ticket,FamilySize,Age,Fare)は削除する</li>
<li>factor変数はone-hotベクトル表現に変換(<code>createDummyFeatures()</code>を使用)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 今一度データの中身を確認----</span>
data_eda <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">datatable</span>(
    <span class="dt">rownames =</span> <span class="ot">FALSE</span>,
    <span class="dt">class =</span> <span class="st">&#39;nowrap&#39;</span>,
    <span class="dt">extensions =</span> <span class="kw">c</span>(<span class="st">&#39;FixedColumns&#39;</span>,<span class="st">&#39;Scroller&#39;</span>),
    <span class="dt">options =</span> <span class="kw">list</span>(
      <span class="co"># FixedColumns</span>
      <span class="dt">dom          =</span> <span class="st">&#39;Bfrtip&#39;</span>,
      <span class="dt">scrollX      =</span> <span class="ot">TRUE</span>,
      <span class="co"># Scroller</span>
      <span class="dt">deferRender =</span> <span class="ot">TRUE</span>,
      <span class="dt">scrollY =</span> <span class="dv">200</span>,
      <span class="dt">scroller =</span> <span class="ot">TRUE</span>
    )
  )</code></pre></div>
<div id="htmlwidget-161129221eaf0856dd64" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-161129221eaf0856dd64">{"x":{"filter":"none","extensions":["FixedColumns","Scroller"],"data":[["0","1","1","1","0","0","0","0","1","1","1","1","0","0","0","1","0","1","0","1","0","1","1","1","0","1","0","0","1","0","0","1","1","0","0","0","1","0","0","1","0","0","0","1","1","0","0","1","0","0"],["3","1","3","1","3","3","1","3","3","2","3","1","3","3","3","2","3","2","3","3","2","2","3","1","3","3","3","1","3","3","1","1","3","2","1","1","3","3","3","3","3","2","3","2","3","3","3","3","3","3"],["Braund, Mr. Owen Harris","Cumings, Mrs. John Bradley (Florence Briggs Thayer)","Heikkinen, Miss. Laina","Futrelle, Mrs. Jacques Heath (Lily May Peel)","Allen, Mr. William Henry","Moran, Mr. James","McCarthy, Mr. Timothy J","Palsson, Master. Gosta Leonard","Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)","Nasser, Mrs. Nicholas (Adele Achem)","Sandstrom, Miss. Marguerite Rut","Bonnell, Miss. Elizabeth","Saundercock, Mr. William Henry","Andersson, Mr. Anders Johan","Vestrom, Miss. Hulda Amanda Adolfina","Hewlett, Mrs. (Mary D Kingcome) ","Rice, Master. Eugene","Williams, Mr. Charles Eugene","Vander Planke, Mrs. Julius (Emelia Maria Vandemoortele)","Masselmani, Mrs. Fatima","Fynney, Mr. Joseph J","Beesley, Mr. Lawrence","McGowan, Miss. Anna \"Annie\"","Sloper, Mr. William Thompson","Palsson, Miss. Torborg Danira","Asplund, Mrs. Carl Oscar (Selma Augusta Emilia Johansson)","Emir, Mr. Farred Chehab","Fortune, Mr. Charles Alexander","O'Dwyer, Miss. Ellen \"Nellie\"","Todoroff, Mr. Lalio","Uruchurtu, Don. Manuel E","Spencer, Mrs. William Augustus (Marie Eugenie)","Glynn, Miss. Mary Agatha","Wheadon, Mr. Edward H","Meyer, Mr. Edgar Joseph","Holverson, Mr. Alexander Oskar","Mamee, Mr. Hanna","Cann, Mr. Ernest Charles","Vander Planke, Miss. Augusta Maria","Nicola-Yarred, Miss. Jamila","Ahlin, Mrs. Johan (Johanna Persdotter Larsson)","Turpin, Mrs. William John Robert (Dorothy Ann Wonnacott)","Kraeff, Mr. Theodor","Laroche, Miss. Simonne Marie Anne Andree","Devaney, Miss. Margaret Delia","Rogers, Mr. William John","Lennon, Mr. Denis","O'Driscoll, Miss. Bridget","Samaan, Mr. Youssef","Arnold-Franchi, Mrs. Josef (Josefine Franchi)"],["male","female","female","female","male","male","male","male","female","female","female","female","male","male","female","female","male","male","female","female","male","male","female","male","female","female","male","male","female","male","male","female","female","male","male","male","male","male","female","female","female","female","male","female","female","male","male","female","male","female"],[22,38,26,35,35,28,54,2,27,14,4,58,20,39,14,55,2,28,31,28,35,34,15,28,8,38,28,19,28,28,40,28,28,66,28,42,28,21,18,14,40,27,28,3,19,28,28,28,28,18],[1,1,0,1,0,0,0,3,0,1,1,0,0,1,0,0,4,0,1,0,0,0,0,0,3,1,0,3,0,0,0,1,0,0,1,1,0,0,2,1,1,1,0,1,0,0,1,0,2,1],[0,0,0,0,0,0,0,1,2,0,1,0,0,5,0,0,1,0,0,0,0,0,0,0,1,5,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],["A/5 21171","PC 17599","STON/O2. 3101282","113803","373450","330877","17463","349909","347742","237736","PP 9549","113783","A/5. 2151","347082","350406","248706","382652","244373","345763","2649","239865","248698","330923","113788","349909","347077","2631","19950","330959","349216","PC 17601","PC 17569","335677","C.A. 24579","PC 17604","113789","2677","A./5. 2152","345764","2651","7546","11668","349253","SC/Paris 2123","330958","S.C./A.4. 23567","370371","14311","2662","349237"],[7.25,71.2833,7.925,53.1,8.05,8.4583,51.8625,21.075,11.1333,30.0708,16.7,26.55,8.05,31.275,7.8542,16,29.125,13,18,7.225,26,13,8.0292,35.5,21.075,31.3875,7.225,263,7.8792,7.8958,27.7208,146.5208,7.75,10.5,82.1708,52,7.2292,8.05,18,11.2417,9.475,21,7.8958,41.5792,7.8792,8.05,15.5,7.75,21.6792,17.8],["S","C","S","S","S","Q","S","S","S","C","S","S","S","S","S","S","Q","S","S","C","S","S","Q","S","S","S","C","S","Q","S","C","C","Q","S","C","S","C","S","S","C","S","S","C","C","Q","S","Q","Q","C","S"],["2","3","2","3","3","3","5","1","3","2","1","5","2","3","2","5","1","3","3","3","3","3","2","3","1","3","3","2","3","3","3","3","3","5","3","4","3","2","2","2","3","3","3","1","2","3","3","3","3","2"],["1","5","2","5","2","2","5","3","3","4","3","4","2","4","1","3","4","3","3","1","4","3","2","4","3","4","1","5","2","2","4","5","1","2","5","5","1","2","3","3","2","3","2","5","2","2","3","1","4","3"],[2,2,1,2,1,1,1,5,3,2,3,1,1,7,1,1,6,1,2,1,1,1,1,1,5,7,1,6,1,1,1,2,1,1,2,2,1,1,3,2,2,2,1,4,1,1,2,1,3,2],["NotAlone","NotAlone","Alone","NotAlone","Alone","Alone","Alone","NotAlone","NotAlone","NotAlone","NotAlone","Alone","Alone","NotAlone","Alone","Alone","NotAlone","Alone","NotAlone","Alone","Alone","Alone","Alone","Alone","NotAlone","NotAlone","Alone","NotAlone","Alone","Alone","Alone","NotAlone","Alone","Alone","NotAlone","NotAlone","Alone","Alone","NotAlone","NotAlone","NotAlone","NotAlone","Alone","NotAlone","Alone","Alone","NotAlone","Alone","NotAlone","NotAlone"],["Mr","Mrs","Miss","Mrs","Mr","Mr","Mr","Master","Mrs","Mrs","Miss","Miss","Mr","Mr","Miss","Mrs","Master","Mr","Mrs","Mrs","Mr","Mr","Miss","Mr","Miss","Mrs","Mr","Mr","Miss","Mr","Misc","Mrs","Miss","Mr","Mr","Mr","Mr","Mr","Miss","Miss","Mrs","Mrs","Mr","Miss","Miss","Mr","Mr","Miss","Mr","Mrs"]],"container":"<table class=\"nowrap\">\n  <thead>\n    <tr>\n      <th>Survived<\/th>\n      <th>Pclass<\/th>\n      <th>Name<\/th>\n      <th>Sex<\/th>\n      <th>Age<\/th>\n      <th>SibSp<\/th>\n      <th>Parch<\/th>\n      <th>Ticket<\/th>\n      <th>Fare<\/th>\n      <th>Embarked<\/th>\n      <th>AgeBin<\/th>\n      <th>FareBin<\/th>\n      <th>FamilySize<\/th>\n      <th>IsAlone<\/th>\n      <th>Title<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","scrollX":true,"deferRender":true,"scrollY":200,"scroller":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8,12]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#data_eda %&gt;% View</span>
data_eda <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(class) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">list.tree</span>(<span class="dt">maxcomp=</span><span class="dv">15</span>)</code></pre></div>
<pre><code>#  . = list 15 (3024 bytes)
# .  Survived = character 1= factor 
# .  Pclass = character 1= factor 
# .  Name = character 1= character 
# .  Sex = character 1= factor 
# .  Age = character 1= numeric 
# .  SibSp = character 1= integer 
# .  Parch = character 1= integer 
# .  Ticket = character 1= character 
# .  Fare = character 1= numeric 
# .  Embarked = character 1= factor 
# .  AgeBin = character 1= factor 
# .  FareBin = character 1= factor 
# .  FamilySize = character 1= numeric 
# .  IsAlone = character 1= factor 
# .  Title = character 1= factor</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Converting(データのフォーマット変更)----</span>
<span class="co"># 1.不必要な説明変数(Name,Ticket,FamilySize,Age,Fare)を削除</span>
<span class="co"># 2.mlr::createDummyFeatures()でfactor型をダミー変数に変換</span>
data_ml &lt;-
<span class="st">  </span>data_eda <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Name, <span class="op">-</span>Ticket, <span class="op">-</span>FamilySize, <span class="op">-</span>Age, <span class="op">-</span>Fare) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">createDummyFeatures</span>(<span class="dt">target=</span><span class="st">&quot;Survived&quot;</span>)</code></pre></div>
<div id="section-5.3.4.1" class="section level4">
<h4><span class="header-section-number">5.3.4.1</span> 定量的データのビニングについて</h4>
<ul>
<li>定量的データをビニングすると線形モデル等の一部のアルゴリズムでは精度が向上することもある。
<ul>
<li>ただし決定木等のアルゴリズムでは精度変わらない or 悪化する可能性もあり。</li>
<li>参考：<a href="http://nlp.dse.ibaraki.ac.jp/~shinnou/zemi2018/py-ml/py-ml-fujii-0525.pdf">Pythonではじめる機械学習</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="section-6" class="section level1">
<h1><span class="header-section-number">6</span> データモデルの作成</h1>
<ul>
<li>説明変数をもとに、目的変数を予測するモデルの作成を行う。</li>
</ul>
<div id="section-6.1" class="section level2">
<h2><span class="header-section-number">6.1</span> アルゴリズムの分類</h2>
<ul>
<li>機械学習のアルゴリズムは大きく以下ように分類できる。
<ul>
<li><strong>教師あり学習</strong>:正しい答えを含む訓練データセットを使用してモデルの訓練を行う。
<ul>
<li>分類:離散変数を目標変数とする教師あり学習</li>
<li>回帰:連続変数を目標変数とする教師あり学習</li>
</ul></li>
<li><strong>教師なし学習</strong>:正しい答えが含まれない訓練データセットを使用して、モデルの訓練を行う。
<ul>
<li>次元削減:データセットの次元数を何かしらの基準に基づき低次元へと削減する。</li>
<li>クラスタリング:データセットを何かしらの基準に基づきグループに分ける。</li>
</ul></li>
<li><strong>強化学習</strong>:上記２つの学習のハイブリッド。モデルははじめから正しい答えを与えられるのではなく、一連のイベントのあとで答えを与えられる。</li>
</ul></li>
<li>今回のプロジェクトは教師あり学習(回帰)に分類される。</li>
</ul>
</div>
<div id="mlr" class="section level2">
<h2><span class="header-section-number">6.2</span> mlrによるモデル作成の流れ</h2>
<ul>
<li><code>mlr</code>パッケージを使った際のデータモデル作成の流れの一例を記載する。</li>
<li><code>mlr</code>に関するより詳細な説明は<a href="https://nozma.github.io/mlr_tutorial/">有志による本家チュートリアルの日本語訳</a>を参照。</li>
</ul>
<ol style="list-style-type: decimal">
<li><strong>タスクの定義</strong>
<ul>
<li>実行したい機械学習の種類(回帰、分類etc), 訓練データ, 目的変数の定義を行う。</li>
</ul></li>
<li><strong>学習器の構築</strong>
<ul>
<li>タスクを実行するために、どの機械学習のアルゴリズムを使用するか選択する。</li>
</ul></li>
<li><strong>学習器の性能評価</strong>
<ul>
<li>ベンチマーク試験を行い、学習器の性能を評価する。</li>
</ul></li>
<li><strong>チューニング</strong>
<ul>
<li>学習器の性能が足りない場合、チューニングを行い精度の向上を目指す。</li>
<li>ハイパーパラメータの最適化、前処理方法の見直し、説明変数の変更などを行う。
<ul>
<li>今回のプロジェクトでは実際にハイパーパラメータのチューニングを行なってみる。</li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="section-6.3" class="section level2">
<h2><span class="header-section-number">6.3</span> タスクの定義</h2>
<p>二値分類問題の場合は<code>makeClassifTask</code>でタスクの定義を行う。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># タスクの定義----</span>
titanic.task =<span class="st"> </span><span class="kw">makeClassifTask</span>(<span class="dt">id=</span><span class="st">&quot;titanic&quot;</span>,<span class="dt">data=</span>data_ml,<span class="dt">target=</span><span class="st">&quot;Survived&quot;</span>)
titanic.task <span class="op">%&gt;%</span><span class="st"> </span>print</code></pre></div>
<pre><code># Supervised task: titanic
# Type: classif
# Target: Survived
# Observations: 891
# Features:
#    numerics     factors     ordered functionals 
#          30           0           0           0 
# Missings: FALSE
# Has weights: FALSE
# Has blocking: FALSE
# Has coordinates: FALSE
# Classes: 2
#   0   1 
# 549 342 
# Positive class: 0</code></pre>
</div>
<div id="section-6.4" class="section level2">
<h2><span class="header-section-number">6.4</span> 学習機の構築</h2>
<ul>
<li><code>listLearners()</code>で使用できる学習器の一覧を確認できる。</li>
<li><code>makeLearner()</code>で学習器の構築を行う。</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用できるアルゴリズムの一覧を出力----</span>
<span class="co"># properties = &quot;prob&quot; : 確率を出力できるアルゴリズムの一覧</span>
<span class="co">#listLearners(titanic.task, properties =&quot;prob&quot;) %&gt;% View</span>
<span class="kw">listLearners</span>(titanic.task, <span class="dt">properties =</span><span class="st">&quot;prob&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">datatable</span>(
    <span class="dt">rownames =</span> <span class="ot">FALSE</span>,
    <span class="dt">class =</span> <span class="st">&#39;nowrap&#39;</span>,
    <span class="dt">extensions =</span> <span class="kw">c</span>(<span class="st">&#39;FixedColumns&#39;</span>,<span class="st">&#39;Scroller&#39;</span>),
    <span class="dt">options =</span> <span class="kw">list</span>(
      <span class="co"># FixedColumns</span>
      <span class="dt">dom          =</span> <span class="st">&#39;Bfrtip&#39;</span>,
      <span class="dt">scrollX      =</span> <span class="ot">TRUE</span>,
      <span class="co"># Scroller</span>
      <span class="dt">deferRender =</span> <span class="ot">TRUE</span>,
      <span class="dt">scrollY =</span> <span class="dv">200</span>,
      <span class="dt">scroller =</span> <span class="ot">TRUE</span>
    )
  )</code></pre></div>
<div id="htmlwidget-3bb9cc06aa9d753c8ef3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3bb9cc06aa9d753c8ef3">{"x":{"filter":"none","extensions":["FixedColumns","Scroller"],"data":[["classif.ada","classif.adaboostm1","classif.bartMachine","classif.binomial","classif.boosting","classif.C50","classif.cvglmnet","classif.dbnDNN","classif.earth","classif.evtree","classif.extraTrees","classif.featureless","classif.gamboost","classif.gausspr","classif.gbm","classif.glmboost","classif.glmnet","classif.h2o.deeplearning","classif.h2o.gbm","classif.h2o.glm","classif.h2o.randomForest","classif.IBk","classif.J48","classif.JRip","classif.kknn","classif.ksvm","classif.lda","classif.LiblineaRL1LogReg","classif.LiblineaRL2LogReg","classif.logreg","classif.mda","classif.mlp","classif.multinom","classif.naiveBayes","classif.neuralnet","classif.nnet","classif.nnTrain","classif.nodeHarvest","classif.OneR","classif.pamr","classif.PART","classif.penalized","classif.plr","classif.plsdaCaret","classif.probit","classif.qda","classif.randomForest","classif.randomForestSRC","classif.ranger","classif.rda"],["ada Boosting","ada Boosting M1","Bayesian Additive Regression Trees","Binomial Regression","Adabag Boosting","C50","GLM with Lasso or Elasticnet Regularization (Cross Validated Lambda)","Deep neural network with weights initialized by DBN","Flexible Discriminant Analysis","Evolutionary learning of globally optimal trees","Extremely Randomized Trees","Featureless classifier","Gradient boosting with smooth components","Gaussian Processes","Gradient Boosting Machine","Boosting for GLMs","GLM with Lasso or Elasticnet Regularization","h2o.deeplearning","h2o.gbm","h2o.glm","h2o.randomForest","k-Nearest Neighbours","J48 Decision Trees","Propositional Rule Learner","k-Nearest Neighbor","Support Vector Machines","Linear Discriminant Analysis","L1-Regularized Logistic Regression","L2-Regularized Logistic Regression","Logistic Regression","Mixture Discriminant Analysis","Multi-Layer Perceptron","Multinomial Regression","Naive Bayes","Neural Network from neuralnet","Neural Network","Training Neural Network by Backpropagation","Node Harvest","1-R Classifier","Nearest shrunken centroid","PART Decision Lists","Penalized Logistic Regression","Logistic Regression with a L2 Penalty","Partial Least Squares (PLS) Discriminant Analysis","Probit Regression","Quadratic Discriminant Analysis","Random Forest","Random Forest","Random Forests","Regularized Discriminant Analysis"],["ada","adaboostm1","bartmachine","binomial","adabag","C50","cvglmnet","dbn.dnn","fda","evtree","extraTrees","featureless","gamboost","gausspr","gbm","glmboost","glmnet","h2o.dl","h2o.gbm","h2o.glm","h2o.rf","ibk","j48","jrip","kknn","ksvm","lda","liblinl1logreg","liblinl2logreg","logreg","mda","mlp","multinom","nbayes","neuralnet","nnet","nn.train","nodeHarvest","oner","pamr","part","penalized","plr","plsdacaret","probit","qda","rf","rfsrc","ranger","rda"],["ada,rpart","RWeka","bartMachine","stats","adabag,rpart","C50","glmnet","deepnet","earth,stats","evtree","extraTrees","mlr","mboost","kernlab","gbm","mboost","glmnet","h2o","h2o","h2o","h2o","RWeka","RWeka","RWeka","kknn","kernlab","MASS","LiblineaR","LiblineaR","stats","mda","RSNNS","nnet","e1071","neuralnet","nnet","deepnet","nodeHarvest","RWeka","pamr","RWeka","penalized","stepPlr","caret,pls","stats","MASS","randomForest","randomForestSRC","ranger","klaR"],["`xval` has been set to `0` by default for speed.","NAs are directly passed to WEKA with `na.action = na.pass`.","`use_missing_data` has been set to `TRUE` by default to allow missing data support.","Delegates to `glm` with freely choosable binomial link function via learner parameter `link`. We set 'model' to FALSE by default to save memory.","`xval` has been set to `0` by default for speed.","","The family parameter is set to `binomial` for two-class problems and to `multinomial` otherwise. Factors automatically get converted to dummy columns, ordered factors to integer.\n      glmnet uses a global control object for its parameters. mlr resets all control parameters to their defaults\n      before setting the specified parameters and after training.\n      If you are setting glmnet.control parameters through glmnet.control,\n      you need to save and re-set them after running the glmnet learner.","`output` set to `\"softmax\"` by default.","This learner performs flexible discriminant analysis using the earth algorithm. na.action is set to na.fail and only this is supported.","`pmutatemajor`, `pmutateminor`, `pcrossover`, `psplit`, and `pprune`,\n      are scaled internally to sum to 100.","","","`family` has been set to `Binomial()` by default. For 'family' 'AUC' and 'AdaExp' probabilities cannot be predicted.","Kernel parameters have to be passed directly and not by using the `kpar` list in `gausspr`.\n    Note that `fit` has been set to `FALSE` by default for speed.","`keep.data` is set to FALSE to reduce memory requirements. Note on param 'distribution': gbm will select 'bernoulli' by default for 2 classes, and 'multinomial' for\n      multiclass problems. The latter is the only setting that works for &gt; 2 classes.","`family` has been set to `Binomial` by default. For 'family' 'AUC' and 'AdaExp' probabilities cannot be predcited.","The family parameter is set to `binomial` for two-class problems and to `multinomial` otherwise.\n      Factors automatically get converted to dummy columns, ordered factors to integer.\n      Parameter `s` (value of the regularization parameter used for predictions) is set to `0.1` by default,\n      but needs to be tuned by the user.\n      glmnet uses a global control object for its parameters. mlr resets all control parameters to their defaults\n      before setting the specified parameters and after training.\n      If you are setting glmnet.control parameters through glmnet.control,\n      you need to save and re-set them after running the glmnet learner.","The default value of `missing_values_handling` is `\"MeanImputation\"`, so missing values are automatically mean-imputed.","'distribution' is set automatically to 'gaussian'.","`family` is always set to `\"binomial\"` to get a binary classifier. The default value of `missing_values_handling` is `\"MeanImputation\"`, so missing values are automatically mean-imputed.","","","NAs are directly passed to WEKA with `na.action = na.pass`.","NAs are directly passed to WEKA with `na.action = na.pass`.","","Kernel parameters have to be passed directly and not by using the `kpar` list in `ksvm`. Note that `fit` has been set to `FALSE` by default for speed.","Learner parameter `predict.method` maps to `method` in `predict.lda`.","","`type = 0` (the default) is primal and `type = 7` is dual problem.","Delegates to `glm` with `family = binomial(link = 'logit')`. We set 'model' to FALSE by default to save memory.","`keep.fitted` has been set to `FALSE` by default for speed and we use `start.method = \"lvq\"` for more robust behavior / less technical crashes.","","","","`err.fct` has been set to `ce` and `linear.output` to FALSE to do classification.","`linout=TRUE` is hardcoded for regression. `size` has been set to `3` by default.","`output` set to `softmax` by default. `max.number.of.layers` can be set to control and tune the maximal number of layers specified via `hidden`.","","NAs are directly passed to WEKA with `na.action = na.pass`.","Threshold for prediction (`threshold.predict`) has been set to `1` by default.","NAs are directly passed to WEKA with `na.action = na.pass`.","trace=FALSE was set by default to disable logging output.","AIC and BIC penalty types can be selected via the new parameter `cp.type`.","","Delegates to `glm` with `family = binomial(link = 'probit')`. We set 'model' to FALSE by default to save memory.","Learner parameter `predict.method` maps to `method` in `predict.qda`.","Note that the rf can freeze the R process if trained on a task with 1 feature which is constant. This can happen in feature forward selection, also due to resampling, and you need to remove such features with removeConstantFeatures.","`na.action` has been set to `\"na.impute\"` by default to allow missing data support.","By default, internal parallelization is switched off (`num.threads = 1`), `verbose` output is disabled, `respect.unordered.factors` is set to `order` for all splitrules. If predict.type='prob' we set 'probability=TRUE' in ranger.","`estimate.error` has been set to `FALSE` by default for speed."],["classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif","classif"],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],[true,true,true,true,true,true,true,false,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,false,true,true,false,true,true,false,true,false,true,true,false,true,true,true,false,true,true,true,true,true,true],[false,false,false,false,false,false,false,false,false,true,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,true,true,true,false],[false,false,true,false,true,true,false,false,false,false,false,true,false,false,true,false,false,true,true,true,true,false,true,true,false,false,false,false,false,false,false,false,false,true,false,false,false,false,true,false,true,false,false,false,false,false,false,true,false,false],[false,false,false,true,false,true,true,false,true,true,true,false,true,false,true,true,true,true,false,true,false,false,false,false,false,false,false,false,false,true,false,false,true,false,false,true,false,false,false,false,false,false,true,false,true,false,false,true,true,false],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],[false,true,false,false,true,true,true,true,true,true,true,true,false,true,true,false,true,true,true,false,true,true,true,true,true,true,true,true,true,false,true,true,true,true,false,true,true,false,true,false,true,false,false,false,false,true,true,true,true,true],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false],[false,false,false,false,true,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,false],[false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]],"container":"<table class=\"nowrap\">\n  <thead>\n    <tr>\n      <th>class<\/th>\n      <th>name<\/th>\n      <th>short.name<\/th>\n      <th>package<\/th>\n      <th>note<\/th>\n      <th>type<\/th>\n      <th>installed<\/th>\n      <th>numerics<\/th>\n      <th>factors<\/th>\n      <th>ordered<\/th>\n      <th>missings<\/th>\n      <th>weights<\/th>\n      <th>prob<\/th>\n      <th>oneclass<\/th>\n      <th>twoclass<\/th>\n      <th>multiclass<\/th>\n      <th>class.weights<\/th>\n      <th>featimp<\/th>\n      <th>oobpreds<\/th>\n      <th>functionals<\/th>\n      <th>single.functional<\/th>\n      <th>se<\/th>\n      <th>lcens<\/th>\n      <th>rcens<\/th>\n      <th>icens<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","scrollX":true,"deferRender":true,"scrollY":200,"scroller":true,"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用するアルゴリズムをリスト化---</span>
titanic.lrns =
<span class="st">  </span><span class="kw">list</span>(
     <span class="kw">makeLearner</span>(<span class="st">&quot;classif.kknn&quot;</span>, <span class="dt">id=</span><span class="st">&quot;kknn&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.naiveBayes&quot;</span>, <span class="dt">id=</span><span class="st">&quot;naiveBayes&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.nnet&quot;</span>, <span class="dt">id=</span><span class="st">&quot;nnet&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.gausspr&quot;</span>, <span class="dt">id=</span><span class="st">&quot;gausspr&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.svm&quot;</span>, <span class="dt">id=</span><span class="st">&quot;svm&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.rpart&quot;</span>, <span class="dt">id=</span><span class="st">&quot;rpart&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.randomForest&quot;</span>, <span class="dt">id=</span><span class="st">&quot;randomForest&quot;</span>)
    ,<span class="kw">makeLearner</span>(<span class="st">&quot;classif.xgboost&quot;</span>, <span class="dt">id=</span><span class="st">&quot;xgboost&quot;</span>)
  )</code></pre></div>
<div id="section-6.4.1" class="section level3">
<h3><span class="header-section-number">6.4.1</span> アルゴリズムの選び方</h3>
<ul>
<li><strong>「すべてのデータセットに対して最も良い予測精度を返すモデル」は存在しない。</strong></li>
<li>最適なアルゴリズムが知りたければ、一通り全てのアルゴリズムを試してみるのが一番早い。
<ul>
<li>といいつつ、実際はとりあえずXGBoost か Fandom forestを使っている人も割と多い。</li>
</ul></li>
</ul>
</div>
</div>
<div id="section-6.5" class="section level2">
<h2><span class="header-section-number">6.5</span> 学習機の性能評価</h2>
<ul>
<li>ベンチマーク試験は<code>benchmark()</code>で実行。</li>
<li>ベンチマーク試験の結果はプロットすることができる。</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># チューニング前の各アルゴリズムの性能を評価----</span>
titanic.bmr =<span class="st"> </span><span class="kw">benchmark</span>(
  <span class="dt">learners    =</span> titanic.lrns,
  <span class="dt">tasks       =</span> titanic.task,
  <span class="dt">resamplings =</span> cv5,
  <span class="dt">measures    =</span> <span class="kw">list</span>(acc,timetrain)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ベンチマークテストの結果(精度)をグラフで確認----</span>
g1&lt;-
<span class="st">  </span><span class="kw">plotBMRBoxplots</span>(
    titanic.bmr,
    <span class="dt">measure =</span> acc,
    <span class="dt">style=</span><span class="st">&quot;violin&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> learner.id) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">6</span>))
g1 <span class="op">%&gt;%</span><span class="st"> </span>print</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ベンチマークテストの訓練にかかった時間をグラフで確認----</span>
g2&lt;-
<span class="st">  </span><span class="kw">plotBMRBoxplots</span>(
    titanic.bmr,
    <span class="dt">measure =</span> timetrain,
    <span class="dt">style=</span><span class="st">&quot;violin&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> learner.id) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">6</span>))
g2 <span class="op">%&gt;%</span><span class="st"> </span>print</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
</div>
<div id="section-6.6" class="section level2">
<h2><span class="header-section-number">6.6</span> モデルのパフォーマンス評価</h2>
<ul>
<li>基本的なデータの整形・機械学習により、80%弱の精度で乗客の生存を予測できた。
<ul>
<li>数行のコードの割には悪くない精度に見える。</li>
</ul></li>
<li>モデルの性能を改良する前に、これ以上時間をかけて改良する価値があるかを考える。
<ul>
<li>例えば、精度を0.1%上げるために3ヶ月の開発期間を設ける価値はあるか？</li>
<li>研究所勤務なら時間をかける価値はあるし、ビジネスの現場では時間をかける価値はない。</li>
</ul></li>
</ul>
<div id="section-6.6.1" class="section level3">
<h3><span class="header-section-number">6.6.1</span> ベースライン精度の決定</h3>
<ul>
<li>モデルを改良する際は、ベースとなるモデルが改良する価値があるかを判断する必要がある。
<ul>
<li>性能の悪いモデルを地道に改良するより、新しいモデルを一から作るほうが早いかもしれない。</li>
</ul></li>
<li>判断基準としては、オッズ比を使用するのが最も簡単
<ul>
<li>今回のプロジェクトであれば、訓練データから61.6%の確率で乗客が死亡していることから、推定精度がそれ以下となるモデルは改良するに値しないと判断する。</li>
</ul></li>
</ul>
</div>
</div>
<div id="section-6.7" class="section level2">
<h2><span class="header-section-number">6.7</span> ハイパーパラメータのチューニング</h2>
<p>「改良する価値がある」と判断したモデルについて、ハイパーパラメータのチューニングを行う。</p>
<div id="section-6.7.1" class="section level3">
<h3><span class="header-section-number">6.7.1</span> グリッドサーチ用のパラメータを設定する。</h3>
<ul>
<li><code>makeParamSet()</code>により、探索したいパラメータを設定。</li>
<li>各モデルのチューニング可能なパラメータを知りたい場合は<code>getParamSet()</code>やヘルプを確認する</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># svmについてチューニングできるハイパーパラメータを確認----</span>
<span class="kw">getParamSet</span>(<span class="st">&quot;classif.svm&quot;</span>)</code></pre></div>
<pre><code>#                        Type  len             Def
# type               discrete    - C-classifica...
# cost                numeric    -               1
# nu                  numeric    -             0.5
# class.weights numericvector &lt;NA&gt;               -
# kernel             discrete    -          radial
# degree              integer    -               3
# coef0               numeric    -               0
# gamma               numeric    -               -
# cachesize           numeric    -              40
# tolerance           numeric    -           0.001
# shrinking           logical    -            TRUE
# cross               integer    -               0
# fitted              logical    -            TRUE
# scale         logicalvector &lt;NA&gt;            TRUE
#                                           Constr Req Tunable Trafo
# type          C-classification,nu-classification   -    TRUE     -
# cost                                    0 to Inf   Y    TRUE     -
# nu                                   -Inf to Inf   Y    TRUE     -
# class.weights                           0 to Inf   -    TRUE     -
# kernel          linear,polynomial,radial,sigmoid   -    TRUE     -
# degree                                  1 to Inf   Y    TRUE     -
# coef0                                -Inf to Inf   Y    TRUE     -
# gamma                                   0 to Inf   Y    TRUE     -
# cachesize                            -Inf to Inf   -    TRUE     -
# tolerance                               0 to Inf   -    TRUE     -
# shrinking                                      -   -    TRUE     -
# cross                                   0 to Inf   -   FALSE     -
# fitted                                         -   -   FALSE     -
# scale                                          -   -    TRUE     -</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># パラメータの意味が知りたい場合はヘルプを確認----</span>
<span class="co">#?svm</span>

<span class="co"># グリッドサーチ用のハイパーパラメータを設定----</span>
grid_n_estimator =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">300</span>)
grid_ratio       =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">1</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, <span class="fl">1.0</span>)
grid_learn       =<span class="st"> </span><span class="kw">c</span>(.<span class="dv">01</span>, .<span class="dv">03</span>, .<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">25</span>)
grid_max_depth   =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span> ,<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>)

titanic.ps =<span class="st"> </span><span class="kw">list</span>(
  
  <span class="co"># kknn</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;k&quot;</span>        ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;distance&quot;</span> ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;kernel&quot;</span>   ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;rectangular&quot;</span>,<span class="st">&quot;inv&quot;</span>,<span class="st">&quot;gaussian&quot;</span>,<span class="st">&quot;optimal&quot;</span>))
  ),
  
  <span class="co"># naiveBayes</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;laplace&quot;</span> ,<span class="dt">values =</span> grid_ratio)
  ),
  
  <span class="co"># nnet</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;size&quot;</span>  ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;maxit&quot;</span> ,<span class="dt">values =</span> grid_n_estimator),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;decay&quot;</span> ,<span class="dt">values =</span> grid_learn)
  ),
  
  <span class="co"># gausspr</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;kernel&quot;</span> ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;rbfdot&quot;</span>,<span class="st">&quot;polydot&quot;</span>,<span class="st">&quot;vanilladot&quot;</span>))
  ),
  
  <span class="co"># svm</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;cost&quot;</span>   ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;kernel&quot;</span> ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;linear&quot;</span>,<span class="st">&quot;polynomial&quot;</span>,<span class="st">&quot;radial&quot;</span>,<span class="st">&quot;sigmoid&quot;</span>)),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;gamma&quot;</span>  ,<span class="dt">values =</span> grid_ratio)
  ),
  
  <span class="co"># rpart</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;cp&quot;</span> ,<span class="dt">values =</span> <span class="kw">c</span>(.<span class="dv">001</span>, .<span class="dv">005</span>, .<span class="dv">01</span>, .<span class="dv">025</span>, .<span class="dv">05</span>))
  ),  
  
  <span class="co"># randomForest</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;ntree&quot;</span> ,<span class="dt">values =</span> grid_n_estimator),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;mtry&quot;</span>  ,<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))
  ),  
  
  <span class="co"># xgboost</span>
  <span class="kw">makeParamSet</span>(
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;eta&quot;</span>       ,<span class="dt">values =</span> grid_learn),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;max_depth&quot;</span> ,<span class="dt">values =</span> grid_max_depth),
    <span class="kw">makeDiscreteParam</span>(<span class="st">&quot;nrounds&quot;</span>   ,<span class="dt">values =</span> grid_n_estimator)
  )
)</code></pre></div>
</div>
<div id="section-6.7.2" class="section level3">
<h3><span class="header-section-number">6.7.2</span> グリッドサーチの実行</h3>
<ul>
<li><code>tuneParams()</code>でグリッドサーチを実行する。</li>
<li>複数アルゴリズムに対してグリッドサーチを実行するために<code>purrr</code>パッケージの関数を使用する。
<ul>
<li>参考：<a href="https://speakerd.s3.amazonaws.com/presentations/5708cd12bda44525920301cab836e0a8/slide.pdf">そろそろ手を出すpurrr</a></li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># グリッドサーチを実行----</span>
titanic.res =
<span class="st">  </span><span class="kw">map2</span>(
    <span class="dt">.x =</span> titanic.lrns,
    <span class="dt">.y =</span> titanic.ps,
    <span class="dt">.f =</span>
      <span class="op">~</span><span class="st"> </span><span class="kw">tuneParams</span>(
        <span class="dt">learner  =</span> .x,
        <span class="dt">task     =</span> titanic.task,
        <span class="dt">resampling =</span> cv5,
        <span class="dt">measures =</span> acc,
        <span class="dt">par.set  =</span> .y,
        <span class="dt">control  =</span> <span class="kw">makeTuneControlGrid</span>()
      )
  )</code></pre></div>
</div>
<div id="section-6.7.3" class="section level3">
<h3><span class="header-section-number">6.7.3</span> チューニングされたハイパーパラメータの設定</h3>
<p><code>setHyperPars()</code>により最適化されたハイパーパラメータを設定する。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># チューニングされたハイパーパラメータを設定----</span>
titanic.lrn.tuned &lt;-
<span class="st">  </span><span class="kw">map2</span>(
    <span class="dt">.x =</span> titanic.lrns,
    <span class="dt">.y =</span> titanic.res,
    <span class="dt">.f =</span>
      <span class="op">~</span><span class="st"> </span><span class="kw">setHyperPars</span>(
        <span class="dt">learner  =</span> .x,
        <span class="dt">par.vals =</span> .y<span class="op">$</span>x
      )
  )</code></pre></div>
</div>
<div id="section-6.7.4" class="section level3">
<h3><span class="header-section-number">6.7.4</span> チューニング後の性能確認</h3>
<p>チューニング前と同様、<code>benchmark()</code>にてベンチマーク試験を実施。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># チューニング後の性能を確認----</span>
titanic.bmr.tuned &lt;-
<span class="st">  </span><span class="kw">benchmark</span>(
    <span class="dt">learners    =</span> titanic.lrn.tuned,
    <span class="dt">tasks       =</span> titanic.task,
    <span class="dt">resamplings =</span> cv5,
    <span class="dt">measures    =</span> <span class="kw">list</span>(acc,timetrain)
  )</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ベンチマークテストの結果をプロット----</span>
g1&lt;-
<span class="st">  </span><span class="kw">plotBMRBoxplots</span>(
    titanic.bmr.tuned,
    <span class="dt">measure =</span> acc,
    <span class="dt">style=</span><span class="st">&quot;violin&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> learner.id) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">6</span>))
<span class="kw">print</span>(g1)</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g2&lt;-
<span class="st">  </span><span class="kw">plotBMRBoxplots</span>(
    titanic.bmr.tuned,
    <span class="dt">measure =</span> timetrain,
    <span class="dt">style=</span><span class="st">&quot;violin&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> learner.id) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">6</span>))
<span class="kw">print</span>(g2)</code></pre></div>
<p><img src="titanic_r2_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
},
"pandoc_args": ["--from", "markdown+autolink_bare_uris+tex_math_single_backslash-implicit_figures"],
"search": false
});
});
</script>

</body>

</html>
